<?xml version="1.0" encoding="Shift_JIS"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
 "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0014)about:internet --> <!-- for too much local security warning -->
<HTML lang="ja" xmlns:v="urn:schemas-microsoft-com:vml"> 
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=shift_jis"/>
<TITLE>VBSメモ</TITLE>

<STYLE type="text/css">
v\:line, v\:rect, v\:fill, v\:image, v\:stroke, v\:roundrect, v\:oval, v\:shape, v\:path, v\:textpath
  { behavior: url(#default#VML); }
A { text-decoration:none; }
A.to_tree { color:#CCDDCC; position:absolute; margin-left:0px; font-size:8pt; }
A.to_next_page { position:absolute; margin-left:40px; font-size:8pt; }
A.to_prev_page { position:absolute; margin-left:58px; font-size:8pt; }
A:visited { color:blue }
<!-- start of insert [PATCH_OF:urlrep_tooltip] -->
DIV.tooltip { color:blue; }
DIV.tooltip textarea { display:none; margin-top:-5px; overflow:hidden; }
<!-- end of [PATCH_OF:urlrep_tooltip] -->
</STYLE>

<SCRIPT type="text/javascript">
//<![CDATA[

function  onLoad()
{
  var  divs, i

  if ( !document.getElementsByTagName )  return;

  divs = document.getElementsByTagName( "A" );
  for ( i = 0; i < divs.length; i++ ) {
    if ( divs[i].className == "to_tree" ) {
      divs[i].style.color = "blue";
      divs[i].style.cursor = "hand";
    }
  }
}

function  selectTreeElem( num )
{
  var tree_url, i1, i2, fname, fname2

  if ( parent.frames.length == 0 ) {
    location.href = "../vbs_memo.html?f1=vbs_memo.files/vbs_memo_tree.html&sub1=svgcats_index_p" + num +
     "&f2=vbs_memo.files/vbs_memo_11.html&sub2=svgcats_vml_p" + num;
  }
  else {
    tree_url = parent.tree.location.href;
    i1 = tree_url.lastIndexOf( "/" );
    i2 = tree_url.lastIndexOf( "\\" );
    if ( i2 > i1 )  i1 = i2;
    fname = tree_url.substring( i1 + 1 );
    i1 = fname.lastIndexOf( "#" );
    if ( i1 >= 0 )  fname = fname.substring( 0, i1 );
    fname2 = "vbs_memo.files/vbs_memo_tree.html";
    i1 = fname2.lastIndexOf( "/" );
    i2 = fname2.lastIndexOf( "\\" );
    if ( i2 > i1 )  i1 = i2;
    fname2 = fname2.substring( i1 + 1 );
    if ( fname == fname2 )
      parent.tree.selectTreeElem( "svgcats_index_p" + num );
    else
      location.href = "../vbs_memo.html?f1=vbs_memo.files/vbs_memo_tree.html&sub1=svgcats_index_p" + num +
       "&f2=vbs_memo.files/vbs_memo_11.html&sub2=svgcats_vml_p" + num;
  }
}

<!-- start of insert [PATCH_OF:urlrep_tooltip] -->
function  over( text, value, cols ){ text.style.display = "inline";
  text.cols=cols; text.rows=1; text.value=value; text.focus(); text.select(); }
function  out( text ){ text.style.display = "none"; }
<!-- end of [PATCH_OF:urlrep_tooltip] -->

//]]>
</SCRIPT>

</HEAD>
<BODY bgcolor="#CCDDCC" onLoad="onLoad();">

<DIV style="position:absolute; margin-left:0px; margin-top:8px; color:red; font-size:8pt;">
(for Internet Explorer)</DIV>
<v:rect style="position:absolute; margin-left:0px; margin-top:8px; width:130px; height:16px;" fillcolor="white" strokecolor="white"/>

<PAGESET>
 
<!-- page 172 --> 
<PAGE>
<A id="svgcats_vml_p172" class="to_tree" style="margin-top:-11px;" onClick="selectTreeElem( '172' );">←</A>
<A href="#svgcats_vml_p173" class="to_next_page" style="margin-top:-11px;">▼</A>
<A href="vbs_memo_10.html#svgcats_vml_p171" class="to_prev_page" style="margin-top:-11px;">▲</A>
<DIV style="position:absolute; margin-left:20px; margin-top:-16px;">
<A id="page_group_top" href="vbs_memo_10.html#page_group_bottom" style="text-decoration:none;">↑</A></DIV>
<v:rect style="position:absolute; margin-left:0px; margin-top:0px; width:659px; height:4889px;" fillcolor="white"/>
<DIV id="text172_1" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#008000; font-weight: bold; margin-left:24px; margin-top:17px; line-height:15px; white-space:nowrap">
<A name="LifeGroupClass">
LifeGroupClass, LifeHandleClass (Version 2)</A></DIV>
<v:rect style="position:absolute; margin-left:29px; margin-top:457px; width:556px; height:3460px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_2" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:463px; line-height:15px; white-space:nowrap">
CaseA<BR/>
WScript.echo&nbsp; "Returned"<BR/>
<BR/>
Set object = CaseB()<BR/>
WScript.echo&nbsp; "Returned"<BR/>
object = Empty<BR/>
<BR/>
Set object = CaseC()<BR/>
WScript.echo&nbsp; "Returned"<BR/>
object = Empty<BR/>
<BR/>
Set object = CaseD()<BR/>
WScript.echo&nbsp; "Returned"<BR/>
object = Empty<BR/>
<BR/>
CaseE<BR/>
WScript.echo&nbsp; "Returned"<BR/>
<BR/>
CaseF<BR/>
WScript.echo&nbsp; "Returned"<BR/>
<BR/>
WScript.echo&nbsp; "End of Main"<BR/>
WScript.echo&nbsp; "もし、ここ以降でデストラクターが動くときは、"+_<BR/>
&nbsp; &nbsp; "プログラム終了時にすべてのオブジェクトを削除する"+_<BR/>
&nbsp; &nbsp; "ことによるデストラクター呼び出しです。"<BR/>
<BR/>
<BR/>
Sub&nbsp; CaseA()&nbsp; '// 相互参照しているオブジェクトの削除<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseA:"<BR/>
&nbsp; &nbsp; Set a_handle = new RootHandleClass&nbsp; &nbsp; &nbsp; &nbsp;: a_handle.p.Name = "A1"<BR/>
&nbsp; &nbsp; Set b_handle = a_handle.p.CreateMember() : b_handle.p.Name = "A2"<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
End Sub<BR/>
<BR/>
Function&nbsp; CaseB()&nbsp; '// ハンドルを返すとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseB:"<BR/>
&nbsp; &nbsp; Set a_handle = new RootHandleClass&nbsp; &nbsp; &nbsp; &nbsp;: a_handle.p.Name = "B1"<BR/>
&nbsp; &nbsp; Set b_handle = a_handle.p.CreateMember() : b_handle.p.Name = "B2"<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
&nbsp; &nbsp; Set CaseB = b_handle<BR/>
End Function<BR/>
<BR/>
Function&nbsp; CaseC()&nbsp; '// LefeGroup から外れるとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseC:"<BR/>
&nbsp; &nbsp; Set a_handle = new RootHandleClass&nbsp; &nbsp; &nbsp; &nbsp;: a_handle.p.Name = "C1"<BR/>
&nbsp; &nbsp; Set b_handle = a_handle.p.CreateMember() : b_handle.p.Name = "C2"<BR/>
&nbsp; &nbsp; Set c_handle = b_handle.p.CreateMember() : c_handle.p.Name = "C3"<BR/>
&nbsp; &nbsp; a_handle.p.LifeGroup.Group.Remove&nbsp; c_handle.p<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
&nbsp; &nbsp; Set CaseC = c_handle<BR/>
End Function<BR/>
<BR/>
Function&nbsp; CaseD()&nbsp; '// ハンドルを複製するとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseD:"<BR/>
&nbsp; &nbsp; Set a_handle = new RootHandleClass&nbsp; &nbsp; &nbsp; &nbsp;: a_handle.p.Name = "D1"<BR/>
&nbsp; &nbsp; Set b_handle = a_handle.p.CreateMember() : b_handle.p.Name = "D2"<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
&nbsp; &nbsp; Set CaseD = b_handle.p.GetReference()<BR/>
End Function<BR/>
<BR/>
Sub&nbsp; CaseE()&nbsp; '// 所属オブジェクトの参照カウンターが 0 から 1 に戻るとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseE:"<BR/>
&nbsp; &nbsp; Set a_handle = new RootHandleClass&nbsp; &nbsp; &nbsp; &nbsp;: a_handle.p.Name = "E1"<BR/>
&nbsp; &nbsp; Set b_handle = a_handle.p.CreateMember() : b_handle.p.Name = "E2"<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
&nbsp; &nbsp; b_handle = Empty<BR/>
&nbsp; &nbsp; Set b_handle = a_handle.p.GetReference()<BR/>
End Sub<BR/>
<BR/>
Sub&nbsp; CaseF()&nbsp; '// LefeGroup を再利用するとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseF:"<BR/>
&nbsp; &nbsp; For count = 1&nbsp; To 2<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set a_handle = new RootHandleClass&nbsp; &nbsp; &nbsp; &nbsp;: a_handle.p.Name = "F1"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set b_handle = a_handle.p.CreateMember() : b_handle.p.Name = "F2"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; a_handle = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; b_handle = Empty<BR/>
&nbsp; &nbsp; Next<BR/>
End Sub<BR/>
<BR/>
<BR/>
Class&nbsp; MemberClass<BR/>
&nbsp; &nbsp; Public&nbsp; Name<BR/>
&nbsp; &nbsp; Public&nbsp; Reference<BR/>
<BR/>
&nbsp; &nbsp; Public&nbsp; LifeGroup&nbsp; '// Don't write except for LifeGroupClass ■追加<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.Name +": MemberClass::Class_Terminate"<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; DestroyReferences()&nbsp; '// ■追加<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Reference = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Function&nbsp; CreateMember()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set CreateMember = Me.LifeGroup.Group.Add( new MemberClass )<BR/>
&nbsp; &nbsp; End Function<BR/>
<BR/>
&nbsp; &nbsp; Public Function&nbsp; GetReference()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set GetReference = Me.LifeGroup.Group.Add( Me.Reference )<BR/>
&nbsp; &nbsp; End Function<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; LifeGroupCounterClass<BR/>
&nbsp; &nbsp; Public&nbsp; Group<BR/>
&nbsp; &nbsp; Public&nbsp; CreatedMemberID<BR/>
&nbsp; &nbsp; Public&nbsp; ReferenceCount<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; RootHandleClass<BR/>
&nbsp; &nbsp; Public&nbsp; p&nbsp; '// Target object of this handle<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Initialize()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set group = new LifeGroupClass<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; group.AddHandle&nbsp; Me, new MemberClass<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.p.LifeGroup.CreatedMemberID &amp;": RootHandleClass::Class_Terminate"<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not IsEmpty( Me.p.LifeGroup.Group ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.p.LifeGroup.Group.AddTerminated&nbsp; Me.p<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; LifeHandleClass<BR/>
&nbsp; &nbsp; Public&nbsp; p&nbsp; '// Target object of this handle<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.p.LifeGroup.CreatedMemberID &amp;": LifeHandleClass::Class_Terminate"<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not IsEmpty( Me.p.LifeGroup.Group ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.p.LifeGroup.Group.AddTerminated&nbsp; Me.p<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; LifeGroupClass<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;Name<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;Objects<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;TerminatedObjects<BR/>
&nbsp; &nbsp; Private&nbsp; m_CreatedMemberID<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Initialize()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects = CreateObject( "Scripting.Dictionary" )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.TerminatedObjects = CreateObject( "Scripting.Dictionary" )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; m_CreatedMemberID = 0<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; "LifeGroupClass::Class_Terminate"<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; AddHandle( Handle, Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If IsEmpty( Object.LifeGroup ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set Object.LifeGroup = new LifeGroupCounterClass<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not IsEmpty( Object.LifeGroup.Group ) Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If not Object.LifeGroup.Group Is Me Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Err.Raise&nbsp; 1, "すでに別の LifeGroup に所属しているようです"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Object.LifeGroup.ReferenceCount = 0 Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.TerminatedObjects.Remove&nbsp; Object.LifeGroup.CreatedMemberID<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup.ReferenceCount = Object.LifeGroup.ReferenceCount + 1<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Else<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Do<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_CreatedMemberID = m_CreatedMemberID + 1<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If not Objects.Exists( m_CreatedMemberID ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exit Do<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Loop<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects( m_CreatedMemberID ) = Object<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set Object.LifeGroup.Group = Me<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup.CreatedMemberID = m_CreatedMemberID<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup.ReferenceCount = 1<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Handle.p = Object<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Function&nbsp; Add( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Add = new LifeHandleClass<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.AddHandle&nbsp; Add, Object<BR/>
&nbsp; &nbsp; End Function<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; Remove( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Object.LifeGroup.Group Is Me Then&nbsp; Exit Sub<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Me.Objects( Object.LifeGroup.CreatedMemberID ) Is Object Then&nbsp; Exit Sub<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.DestroyReferences<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.Remove&nbsp; Object.LifeGroup.CreatedMemberID<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup.Group = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup.CreatedMemberID = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; AddTerminated( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Object.LifeGroup.Group Is Me Then&nbsp; Exit Sub<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Me.Objects( Object.LifeGroup.CreatedMemberID ) Is Object Then&nbsp; Exit Sub<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup.ReferenceCount = Object.LifeGroup.ReferenceCount - 1<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If Object.LifeGroup.ReferenceCount = 0 Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set Me.TerminatedObjects( Object.LifeGroup.CreatedMemberID ) = Object<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Me.TerminatedObjects.Count = Me.Objects.Count Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For Each&nbsp; a_object&nbsp; In Me.Objects.Items<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a_object.DestroyReferences<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a_object.LifeGroup = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Next<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.RemoveAll<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.TerminatedObjects.RemoveAll<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class</DIV>
<DIV id="text172_3" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:47px; line-height:15px; white-space:nowrap">
ルート オブジェクトの中にある、相互参照しているオブジェクトのグループとなるオブジェクト。<BR/>
グループに所属しているオブジェクト（ルート オブジェクトも含む）のハンドルがすべて参照され<BR/>
なくなったら、相互参照を切るメソッド DestroyReferences を呼び出し、Class_Terminate が<BR/>
呼び出されます。<BR/>
ハンドルのメンバー p を介してオブジェクトを操作する必要があります。</DIV>
<v:line style="position:absolute;" from="156,261" to="156,311" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="156,311" to="160,300" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="156,311" to="152,300" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:145px; margin-top:176px; width:23px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_5" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:153px; margin-top:182px; line-height:15px; white-space:nowrap">
A</DIV>
<v:rect style="position:absolute; margin-left:281px; margin-top:315px; width:55px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_6" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:289px; margin-top:321px; line-height:15px; white-space:nowrap">
B body</DIV>
<v:line style="position:absolute;" from="156,137" to="156,170" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="156,170" to="160,159" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="156,170" to="152,159" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="211,323" to="270,323" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="270,323" to="259,319" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="270,323" to="259,327" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="267,339" to="213,339" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="213,339" to="224,343" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="213,339" to="224,335" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:145px; margin-top:315px; width:54px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_10" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:153px; margin-top:321px; line-height:15px; white-space:nowrap">
A body</DIV>
<v:line style="position:absolute;" from="313,138" to="313,171" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="313,171" to="317,160" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="313,171" to="309,160" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="313,261" to="313,311" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="313,311" to="317,300" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="313,311" to="309,300" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:302px; margin-top:177px; width:24px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_13" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:310px; margin-top:183px; line-height:15px; white-space:nowrap">
B</DIV>
<v:rect style="position:absolute; margin-left:198px; margin-top:250px; width:71px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_14" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:206px; margin-top:256px; line-height:15px; white-space:nowrap">
LifeGroup</DIV>
<v:line style="position:absolute;" from="241,197" to="241,245" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="241,245" to="245,234" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="241,245" to="237,234" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="226,197" to="226,245" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="226,245" to="230,234" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="226,245" to="222,234" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="241,197" to="296,197" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="226,197" to="180,197" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="156,261" to="191,261" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="313,261" to="274,261" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="234,281" to="234,321" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="234,321" to="238,310" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="234,321" to="230,310" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="146,210" to="146,311" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="146,311" to="150,300" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="146,311" to="142,300" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="322,209" to="322,311" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="322,311" to="326,300" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="322,311" to="318,300" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_24" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:354px; margin-top:183px; line-height:15px; white-space:nowrap">
LifeHandleClass</DIV>
<DIV id="text172_25" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:125px; margin-top:214px; line-height:15px; white-space:nowrap">
p</DIV>
<DIV id="text172_26" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:206px; margin-top:179px; line-height:15px; white-space:nowrap">
LifeGroup</DIV>
<DIV id="text172_27" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:332px; margin-top:216px; line-height:15px; white-space:nowrap">
p</DIV>
<v:line style="position:absolute;" from="305,273" to="276,273" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="276,273" to="287,277" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="276,273" to="287,269" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="305,273" to="305,311" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="167,311" to="167,273" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="167,273" to="189,273" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="189,273" to="178,269" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="189,273" to="178,277" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="226,282" to="226,299" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="242,282" to="242,300" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="226,300" to="174,300" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="174,300" to="185,304" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="174,300" to="185,296" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="242,300" to="292,300" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="292,300" to="281,296" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="292,300" to="281,304" strokecolor="#FF0000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:29px; margin-top:3962px; width:496px; height:895px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text172_36" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:3968px; line-height:15px; white-space:nowrap">
CaseA:<BR/>
1: RootHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
A1: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
A2: MemberClass::Class_Terminate<BR/>
Returned<BR/>
<BR/>
CaseB:<BR/>
1: RootHandleClass::Class_Terminate<BR/>
Returned<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
B1: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
B2: MemberClass::Class_Terminate<BR/>
<BR/>
CaseC:<BR/>
1: RootHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
C1: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
C2: MemberClass::Class_Terminate<BR/>
Returned<BR/>
: LifeHandleClass::Class_Terminate<BR/>
C3: MemberClass::Class_Terminate<BR/>
<BR/>
CaseD:<BR/>
1: RootHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
Returned<BR/>
1: LifeHandleClass::Class_Terminate<BR/>
D2: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
D1: MemberClass::Class_Terminate<BR/>
<BR/>
CaseE:<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
1: RootHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
E1: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
E2: MemberClass::Class_Terminate<BR/>
Returned<BR/>
<BR/>
CaseF:<BR/>
1: RootHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
F1: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
F2: MemberClass::Class_Terminate<BR/>
1: RootHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
F1: MemberClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
F2: MemberClass::Class_Terminate<BR/>
Returned<BR/>
End of Main<BR/>
もし、ここ以降でデストラクターが動くときは、プログラム終了時にすべてのオブジェク<BR/>
トを削除することによるデストラクター呼び出しです。</DIV>
<DIV id="text172_37" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:30px; margin-top:3941px; line-height:15px; white-space:nowrap">
表示例：</DIV>
<DIV id="text172_38" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:434px; line-height:15px; white-space:nowrap">
検証コード</DIV>
<DIV id="text172_39" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:38px; margin-top:182px; line-height:15px; white-space:nowrap">
RootHandleClass</DIV>
<DIV id="text172_40" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#408080; font-weight: bold; margin-left:24px; margin-top:391px; line-height:15px; white-space:nowrap">
関連</DIV>
<DIV id="text172_41" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#0000FF; margin-left:71px; margin-top:391px; line-height:15px; white-space:nowrap">
<A href="..\vbslib.files\vbslib_22.html#LifeGroupClass">
→ LifeGroupClass (vbslib)</A></DIV>
<DIV id="text172_42" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#0000FF; margin-left:71px; margin-top:365px; line-height:15px; white-space:nowrap">
<A href="..\vbslib.files\vbslib_22.html#g_ObjectIDs">
→ g_ObjectIDs</A></DIV>
<DIV id="text172_43" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#408080; font-weight: bold; margin-left:24px; margin-top:365px; line-height:15px; white-space:nowrap">
参考</DIV>

<v:line from="0,0" to="659,0"/>
<v:line from="659,0" to="659,4889"/>
<v:line from="659,4889" to="0,4889"/>
<v:line from="0,4889" to="0,0"/>

</PAGE>
 
<!-- page 173 --> 
<PAGE>
<A id="svgcats_vml_p173" class="to_tree" style="margin-top:4894px;" onClick="selectTreeElem( '173' );">←</A>
<A href="#svgcats_vml_p174" class="to_next_page" style="margin-top:4894px;">▼</A>
<A href="#svgcats_vml_p172" class="to_prev_page" style="margin-top:4894px;">▲</A>
<v:rect style="position:absolute; margin-left:0px; margin-top:4905px; width:582px; height:3465px;" fillcolor="white"/>
<DIV id="text173_1" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#008000; font-weight: bold; margin-left:24px; margin-top:4922px; line-height:15px; white-space:nowrap">
<A name="LifeGroupClass_1">
LifeGroupClass, LifeHandleClass (Version 1)</A></DIV>
<v:rect style="position:absolute; margin-left:29px; margin-top:5281px; width:508px; height:2395px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_2" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:5287px; line-height:15px; white-space:nowrap">
CaseA<BR/>
WScript.echo&nbsp; "Returned"<BR/>
<BR/>
Set object = CaseB()<BR/>
WScript.echo&nbsp; "Returned"<BR/>
object = Empty<BR/>
<BR/>
Set object = CaseC()<BR/>
WScript.echo&nbsp; "Returned"<BR/>
object = Empty<BR/>
<BR/>
CaseD<BR/>
WScript.echo&nbsp; "Returned"<BR/>
<BR/>
WScript.echo&nbsp; "End of Main"<BR/>
WScript.echo&nbsp; "もし、ここ以降でデストラクターが動くときは、"+_<BR/>
&nbsp; &nbsp; "プログラム終了時にすべてのオブジェクトを削除する"+_<BR/>
&nbsp; &nbsp; "ことによるデストラクター呼び出しです。"<BR/>
<BR/>
<BR/>
Sub&nbsp; CaseA()&nbsp; '// 相互参照しているオブジェクトの削除<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseA:"<BR/>
&nbsp; &nbsp; Set group = new LifeGroupClass : group.Name = "CaseA"<BR/>
&nbsp; &nbsp; Set a_handle = group.Add( new MutualClass ) : a_handle.p.Name = "A1"<BR/>
&nbsp; &nbsp; Set b_handle = group.Add( new MutualClass ) : b_handle.p.Name = "A2"<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
End Sub<BR/>
<BR/>
Function&nbsp; CaseB()&nbsp; '// ハンドルを返すとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseB:"<BR/>
&nbsp; &nbsp; Set group = new LifeGroupClass : group.Name = "CaseB"<BR/>
&nbsp; &nbsp; Set a_handle = group.Add( new MutualClass ) : a_handle.p.Name = "B1"<BR/>
&nbsp; &nbsp; Set b_handle = group.Add( new MutualClass ) : b_handle.p.Name = "B2"<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
&nbsp; &nbsp; Set CaseB = a_handle<BR/>
End Function<BR/>
<BR/>
Function&nbsp; CaseC()&nbsp; '// LefeGroup から外れるとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseC:"<BR/>
&nbsp; &nbsp; Set group = new LifeGroupClass : group.Name = "CaseC"<BR/>
&nbsp; &nbsp; Set a_handle = group.Add( new MutualClass ) : a_handle.p.Name = "C1"<BR/>
&nbsp; &nbsp; Set b_handle = group.Add( new MutualClass ) : b_handle.p.Name = "C2"<BR/>
&nbsp; &nbsp; Set c_handle = group.Add( new MutualClass ) : c_handle.p.Name = "C3"<BR/>
&nbsp; &nbsp; group.Remove&nbsp; c_handle.p<BR/>
&nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
&nbsp; &nbsp; Set CaseC = c_handle<BR/>
End Function<BR/>
<BR/>
Sub&nbsp; CaseD()&nbsp; '// LefeGroup を再利用するとき<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"CaseD:"<BR/>
&nbsp; &nbsp; Set group = new LifeGroupClass : group.Name = "CaseD"<BR/>
&nbsp; &nbsp; For count = 1&nbsp; To 2<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set a_handle = group.Add( new MutualClass ) : a_handle.p.Name = "D1"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set b_handle = group.Add( new MutualClass ) : b_handle.p.Name = "D2"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set a_handle.p.Reference = b_handle.p<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set b_handle.p.Reference = a_handle.p<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; a_handle = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; b_handle = Empty<BR/>
&nbsp; &nbsp; Next<BR/>
End Sub<BR/>
<BR/>
<BR/>
Class&nbsp; MutualClass<BR/>
&nbsp; &nbsp; Public&nbsp; Name<BR/>
&nbsp; &nbsp; Public&nbsp; Reference<BR/>
<BR/>
&nbsp; &nbsp; Public&nbsp; LifeGroup&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '// Don't write except for LifeGroupClass<BR/>
&nbsp; &nbsp; Public&nbsp; LifeGroupMemberID&nbsp; '// Don't write except for LifeGroupClass<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.Name +": MutualClass::Class_Terminate"<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; DestroyReferences()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Reference = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; LifeHandleClass<BR/>
&nbsp; &nbsp; Public&nbsp; p&nbsp; '// Target object of this handle<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.p.LifeGroupMemberID &amp;": LifeHandleClass::Class_Terminate"<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not IsEmpty( Me.p.LifeGroup ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.p.LifeGroup.AddTerminated&nbsp; Me.p<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; LifeGroupClass<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;Name<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;Objects<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;TerminatedObjects<BR/>
&nbsp; &nbsp; Private&nbsp; m_CreatedMemberID<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Initialize()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects = CreateObject( "Scripting.Dictionary" )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.TerminatedObjects = CreateObject( "Scripting.Dictionary" )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; m_CreatedMemberID = 0<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; "LifeGroupClass::Class_Terminate"<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Function&nbsp; Add( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not IsEmpty( Object.LifeGroup ) Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Object.LifeGroup Is Me Then&nbsp; Set Add = Nothing : Exit Function<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Err.Raise&nbsp; 1, "すでに別の LifeGroup に所属しているようです"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Do<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_CreatedMemberID = m_CreatedMemberID + 1<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If not Objects.Exists( m_CreatedMemberID ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exit Do<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Loop<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects( m_CreatedMemberID ) = Object<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Object.LifeGroup = Me<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroupMemberID = m_CreatedMemberID<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Add = new LifeHandleClass<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Add.p = Object<BR/>
&nbsp; &nbsp; End Function<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; Remove( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Object.LifeGroup Is Me Then&nbsp; Exit Sub<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Me.Objects( Object.LifeGroupMemberID ) Is Object Then&nbsp; Exit Sub<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.DestroyReferences<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.Remove&nbsp; m_CreatedMemberID<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroup = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.LifeGroupMemberID = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; AddTerminated( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Object.LifeGroup Is Me Then&nbsp; Exit Sub<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If not Me.Objects( Object.LifeGroupMemberID ) Is Object Then&nbsp; Exit Sub<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.TerminatedObjects( Object.LifeGroupMemberID ) = Object<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; If Me.TerminatedObjects.Count = Me.Objects.Count Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For Each&nbsp; a_object&nbsp; In Me.Objects.Items<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a_object.DestroyReferences<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a_object.LifeGroup = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a_object.LifeGroupMemberID = Empty<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Next<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.RemoveAll<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.TerminatedObjects.RemoveAll<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class</DIV>
<DIV id="text173_3" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:4952px; line-height:15px; white-space:nowrap">
相互参照しているオブジェクトのグループとなるオブジェクト。<BR/>
グループに所属しているオブジェクトのハンドルがすべて参照されなくなったら、<BR/>
相互参照を切るメソッド DestroyReferences を呼び出し、Class_Terminate が呼び出されます。<BR/>
ハンドルのメンバー p を介してオブジェクトを操作する必要があります。</DIV>
<v:line style="position:absolute;" from="124,5161" to="124,5211" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="124,5211" to="128,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="124,5211" to="120,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:113px; margin-top:5076px; width:23px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_5" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:121px; margin-top:5082px; line-height:15px; white-space:nowrap">
A</DIV>
<v:rect style="position:absolute; margin-left:249px; margin-top:5215px; width:55px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_6" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:257px; margin-top:5221px; line-height:15px; white-space:nowrap">
B body</DIV>
<v:line style="position:absolute;" from="124,5037" to="124,5070" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="124,5070" to="128,5059" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="124,5070" to="120,5059" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="179,5223" to="238,5223" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="238,5223" to="227,5219" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="238,5223" to="227,5227" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="235,5239" to="181,5239" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="181,5239" to="192,5243" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="181,5239" to="192,5235" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:113px; margin-top:5215px; width:54px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_10" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:121px; margin-top:5221px; line-height:15px; white-space:nowrap">
A body</DIV>
<v:line style="position:absolute;" from="281,5038" to="281,5071" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="281,5071" to="285,5060" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="281,5071" to="277,5060" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="281,5161" to="281,5211" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="281,5211" to="285,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="281,5211" to="277,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:270px; margin-top:5076px; width:24px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_13" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:278px; margin-top:5082px; line-height:15px; white-space:nowrap">
B</DIV>
<v:rect style="position:absolute; margin-left:166px; margin-top:5076px; width:71px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_14" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:174px; margin-top:5082px; line-height:15px; white-space:nowrap">
LifeGroup</DIV>
<v:line style="position:absolute;" from="266,5089" to="241,5089" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="241,5089" to="252,5093" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="241,5089" to="252,5085" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="139,5089" to="162,5089" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="162,5089" to="151,5085" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="162,5089" to="151,5093" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="124,5161" to="170,5161" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="281,5161" to="229,5161" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="202,5109" to="202,5221" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="202,5221" to="206,5210" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="202,5221" to="198,5210" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="114,5110" to="114,5211" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="114,5211" to="118,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="114,5211" to="110,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="290,5109" to="290,5211" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="290,5211" to="294,5200" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="290,5211" to="286,5200" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_22" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:322px; margin-top:5083px; line-height:15px; white-space:nowrap">
LifeHandleClass</DIV>
<DIV id="text173_23" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:93px; margin-top:5114px; line-height:15px; white-space:nowrap">
p</DIV>
<DIV id="text173_24" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:300px; margin-top:5116px; line-height:15px; white-space:nowrap">
p</DIV>
<v:line style="position:absolute;" from="220,5175" to="220,5112" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="220,5112" to="216,5123" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="220,5112" to="224,5123" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="273,5173" to="273,5211" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="135,5211" to="135,5173" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="181,5173" to="181,5109" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="181,5109" to="177,5120" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="181,5109" to="185,5120" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="194,5112" to="194,5199" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="210,5109" to="210,5200" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="194,5200" to="142,5200" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="142,5200" to="153,5204" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="142,5200" to="153,5196" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="210,5200" to="260,5200" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="260,5200" to="249,5196" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="260,5200" to="249,5204" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="201,5038" to="201,5071" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="201,5071" to="205,5060" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="201,5071" to="197,5060" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="135,5173" to="181,5173" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="220,5175" to="273,5175" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="170,5161" to="170,5111" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="229,5161" to="229,5112" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:29px; margin-top:7728px; width:496px; height:610px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text173_38" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:7734px; line-height:15px; white-space:nowrap">
CaseA:<BR/>
1: LifeHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
A1: MutualClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
A2: MutualClass::Class_Terminate<BR/>
Returned<BR/>
<BR/>
CaseB:<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
Returned<BR/>
1: LifeHandleClass::Class_Terminate<BR/>
B2: MutualClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
B1: MutualClass::Class_Terminate<BR/>
<BR/>
CaseC:<BR/>
1: LifeHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
C1: MutualClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
C2: MutualClass::Class_Terminate<BR/>
Returned<BR/>
: LifeHandleClass::Class_Terminate<BR/>
C3: MutualClass::Class_Terminate<BR/>
<BR/>
CaseD:<BR/>
1: LifeHandleClass::Class_Terminate<BR/>
2: LifeHandleClass::Class_Terminate<BR/>
D1: MutualClass::Class_Terminate<BR/>
D2: MutualClass::Class_Terminate<BR/>
3: LifeHandleClass::Class_Terminate<BR/>
4: LifeHandleClass::Class_Terminate<BR/>
D1: MutualClass::Class_Terminate<BR/>
D2: MutualClass::Class_Terminate<BR/>
LifeGroupClass::Class_Terminate<BR/>
Returned<BR/>
End of Main<BR/>
もし、ここ以降でデストラクターが動くときは、プログラム終了時にすべてのオブジェク<BR/>
トを削除することによるデストラクター呼び出しです。</DIV>
<DIV id="text173_39" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:30px; margin-top:7707px; line-height:15px; white-space:nowrap">
表示例：</DIV>
<DIV id="text173_40" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:5258px; line-height:15px; white-space:nowrap">
検証コード</DIV>

<v:line from="0,4905" to="582,4905"/>
<v:line from="582,4905" to="582,8370"/>
<v:line from="582,8370" to="0,8370"/>
<v:line from="0,8370" to="0,4905"/>

</PAGE>
 
<!-- page 174 --> 
<PAGE>
<A id="svgcats_vml_p174" class="to_tree" style="margin-top:8375px;" onClick="selectTreeElem( '174' );">←</A>
<A href="#svgcats_vml_p175" class="to_next_page" style="margin-top:8375px;">▼</A>
<A href="#svgcats_vml_p173" class="to_prev_page" style="margin-top:8375px;">▲</A>
<v:rect style="position:absolute; margin-left:0px; margin-top:8386px; width:593px; height:1160px;" fillcolor="white"/>
<DIV id="text174_1" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#008000; font-weight: bold; margin-left:24px; margin-top:8403px; line-height:15px; white-space:nowrap">
<A name="Class_Terminate_wrap">
ラッパーによる Class_Terminate 呼び出し</A></DIV>
<v:rect style="position:absolute; margin-left:29px; margin-top:8648px; width:532px; height:760px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text174_2" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:8654px; line-height:15px; white-space:nowrap">
Case4<BR/>
WScript.echo&nbsp; "End of Main"<BR/>
WScript.echo&nbsp; "もし、ここ以降でデストラクターが動くときは、"+_<BR/>
&nbsp; &nbsp; "プログラム終了時にすべてのオブジェクトを削除する"+_<BR/>
&nbsp; &nbsp; "ことによるデストラクター呼び出しです。"<BR/>
<BR/>
Sub&nbsp; Case4()<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; "Case4:"<BR/>
&nbsp; &nbsp; Set a_object = new A_Class : a_object.CaseName = "Case4"<BR/>
&nbsp; &nbsp; Set b_object = new B_Class : b_object.CaseName = "Case4"<BR/>
&nbsp; &nbsp; Set a_object.Reference = b_object<BR/>
&nbsp; &nbsp; Set b_object.Reference = a_object.Body&nbsp; '// ここが a_object では呼び出されなくなる<BR/>
End Sub<BR/>
<BR/>
<BR/>
Class&nbsp; A_Class<BR/>
&nbsp; &nbsp; Public&nbsp; Body<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Initialize()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Body = new A_BodyClass<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Body.Reference = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Property Get&nbsp; CaseName() : CaseName = Body.CaseName : End Property<BR/>
&nbsp; &nbsp; Public Property Let&nbsp; CaseName( x ) : Body.CaseName = x : End Property<BR/>
<BR/>
&nbsp; &nbsp; Public Property Get&nbsp; Reference() : Set Reference = Body.Reference : End Property<BR/>
&nbsp; &nbsp; Public Property Set&nbsp; Reference( x ) : Set Body.Reference = x : End Property<BR/>
End Class<BR/>
<BR/>
Class&nbsp; A_BodyClass<BR/>
&nbsp; &nbsp; Public&nbsp; CaseName<BR/>
&nbsp; &nbsp; Public&nbsp; Reference<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.CaseName +": A_Class::Class_Terminate"<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
Class&nbsp; B_Class<BR/>
&nbsp; &nbsp; Public&nbsp; CaseName<BR/>
&nbsp; &nbsp; Public&nbsp; Reference<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.CaseName +": B_Class::Class_Terminate"<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class</DIV>
<DIV id="text174_3" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:8627px; line-height:15px; white-space:nowrap">
検証コード</DIV>
<DIV id="text174_4" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:8435px; line-height:15px; white-space:nowrap">
相互参照しているオブジェクトが、Class_Terminate を呼び出せるようにしたクラス。<BR/>
このクラスのオブジェクトが削除されたとき、相互参照しているオブジェクトも削除される。</DIV>
<v:rect style="position:absolute; margin-left:29px; margin-top:9445px; width:202px; height:70px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text174_5" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:9451px; line-height:15px; white-space:nowrap">
Case4:<BR/>
Case4: B_Class::Class_Terminate<BR/>
Case4: A_Class::Class_Terminate<BR/>
End of Main</DIV>
<DIV id="text174_6" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:9427px; line-height:15px; white-space:nowrap">
表示例：</DIV>
<v:line style="position:absolute;" from="222,8601" to="168,8601" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="168,8601" to="179,8605" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="168,8601" to="179,8597" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="166,8585" to="225,8585" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="225,8585" to="214,8581" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="225,8585" to="214,8589" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="248,8496" to="248,8569" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="248,8569" to="252,8558" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="248,8569" to="244,8558" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="111,8490" to="111,8510" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="111,8510" to="115,8499" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="111,8510" to="107,8499" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:236px; margin-top:8577px; width:25px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text174_11" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:244px; margin-top:8583px; line-height:15px; white-space:nowrap">
B</DIV>
<v:rect style="position:absolute; margin-left:100px; margin-top:8516px; width:23px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text174_12" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:108px; margin-top:8522px; line-height:15px; white-space:nowrap">
A</DIV>
<v:rect style="position:absolute; margin-left:100px; margin-top:8577px; width:54px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text174_13" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:108px; margin-top:8583px; line-height:15px; white-space:nowrap">
A body</DIV>
<v:line style="position:absolute;" from="111,8549" to="111,8572" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="111,8572" to="115,8561" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="111,8572" to="107,8561" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="194,8530" to="194,8577" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="194,8577" to="198,8566" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="194,8577" to="190,8566" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="194,8530" to="135,8530" strokecolor="#FF0000" strokeweight="1pt"/>
<DIV id="text174_17" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:8pt; color:#FF0000; margin-left:150px; margin-top:8517px; line-height:12px; white-space:nowrap">
相互参照を切る</DIV>

<v:line from="0,8386" to="593,8386"/>
<v:line from="593,8386" to="593,9546"/>
<v:line from="593,9546" to="0,9546"/>
<v:line from="0,9546" to="0,8386"/>

</PAGE>
 
<!-- page 175 --> 
<PAGE>
<A id="svgcats_vml_p175" class="to_tree" style="margin-top:9551px;" onClick="selectTreeElem( '175' );">←</A>
<A href="vbs_memo_12.html#svgcats_vml_p176" class="to_next_page" style="margin-top:9551px;">▼</A>
<A href="#svgcats_vml_p174" class="to_prev_page" style="margin-top:9551px;">▲</A>
<v:rect style="position:absolute; margin-left:0px; margin-top:9562px; width:731px; height:2493px;" fillcolor="white"/>
<DIV id="text175_1" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#008000; font-weight: bold; margin-left:24px; margin-top:9579px; line-height:15px; white-space:nowrap">
<A name="DestroyerClass">
DestroyerClass (version 2)</A></DIV>
<v:rect style="position:absolute; margin-left:29px; margin-top:9853px; width:670px; height:1810px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text175_2" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:9859px; line-height:15px; white-space:nowrap">
Case1<BR/>
WScript.echo&nbsp; "End of Main"<BR/>
Case2<BR/>
WScript.echo&nbsp; "End of Main"<BR/>
WScript.echo&nbsp; "もし、ここ以降でデストラクターが動くときは、"+_<BR/>
&nbsp; &nbsp; "プログラム終了時にすべてのオブジェクトを削除する"+_<BR/>
&nbsp; &nbsp; "ことによるデストラクター呼び出しです。"<BR/>
<BR/>
Sub&nbsp; Case1()<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"Case1:"<BR/>
&nbsp; &nbsp; Set destroyer = new DestroyerClass<BR/>
&nbsp; &nbsp; Set a_object = new A_Class : a_object.CaseName = "Case1" : destroyer.Add&nbsp; a_object<BR/>
&nbsp; &nbsp; Set b_object = new B_Class : b_object.CaseName = "Case1" : destroyer.Add&nbsp; b_object<BR/>
&nbsp; &nbsp; Set a_object.Reference = b_object<BR/>
&nbsp; &nbsp; Set b_object.Reference = a_object<BR/>
End Sub<BR/>
<BR/>
Sub&nbsp; Case2()<BR/>
&nbsp; &nbsp; WScript.echo&nbsp; vbCRLF +"Case2:"<BR/>
&nbsp; &nbsp; Set destroyer = new DestroyerClass<BR/>
&nbsp; &nbsp; Set a_object = new A_Class : a_object.CaseName = "Case2"<BR/>
&nbsp; &nbsp; Set b_object = new B_Class : b_object.CaseName = "Case2"<BR/>
&nbsp; &nbsp; Set a_object.Reference = b_object<BR/>
&nbsp; &nbsp; Set b_object.Reference = a_object<BR/>
End Sub<BR/>
<BR/>
<BR/>
Class&nbsp; DestroyerClass<BR/>
&nbsp; &nbsp; Public&nbsp; Objects<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Initialize()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects = new ObjectSetClass<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; "DestroyerClass::Class_Terminate"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; For Each&nbsp; item&nbsp; In Me.Objects.Objects.Items<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; item.DestroyReferences<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Next<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; Add( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.Add&nbsp; Object<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.IsDestroyer = True<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; Remove( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.Remove&nbsp; Object<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Object.IsDestroyer = False<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
Sub&nbsp; CheckUnderDestroyer( Object )<BR/>
&nbsp; &nbsp; If not Object.IsDestroyer Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Err.Raise 1,, "このオブジェクトは相互参照しているため、DestroyerClass の管理下に置く必要があります。"<BR/>
End Sub<BR/>
<BR/>
<BR/>
Class&nbsp; A_Class<BR/>
&nbsp; &nbsp; Public&nbsp; CaseName<BR/>
&nbsp; &nbsp; Public&nbsp; Reference<BR/>
&nbsp; &nbsp; Public&nbsp; IsDestroyer&nbsp; &nbsp; '// ■追加<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.CaseName +": A_Class::Class_Terminate"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; CheckUnderDestroyer&nbsp; Me&nbsp; '// ■追加<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; DestroyReferences()&nbsp; '// ■追加<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Reference = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
Class&nbsp; B_Class<BR/>
&nbsp; &nbsp; Public&nbsp; CaseName<BR/>
&nbsp; &nbsp; Public&nbsp; Reference<BR/>
&nbsp; &nbsp; Public&nbsp; IsDestroyer&nbsp; &nbsp; '// ■追加<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Terminate()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; WScript.echo&nbsp; Me.CaseName +": B_Class::Class_Terminate"<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; CheckUnderDestroyer&nbsp; Me&nbsp; '// ■追加<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; DestroyReferences()&nbsp; '// ■追加<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Me.Reference = Empty<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class<BR/>
<BR/>
<BR/>
Class&nbsp; ObjectSetClass<BR/>
&nbsp; &nbsp; Public&nbsp; &nbsp;Objects<BR/>
&nbsp; &nbsp; Private&nbsp; m_NextID<BR/>
<BR/>
&nbsp; &nbsp; Private Sub&nbsp; Class_Initialize()<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects = CreateObject( "Scripting.Dictionary" )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; m_NextID = 0<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; Add( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; For Each&nbsp; item&nbsp; In Me.Objects.Items<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If item is Object Then&nbsp; Exit Sub<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Next<BR/>
<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Do<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_NextID = m_NextID + 1<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If not Objects.Exists( CStr( m_NextID ) ) Then _<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exit Do<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Loop<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Set Me.Objects( CStr( m_NextID ) ) = Object<BR/>
&nbsp; &nbsp; End Sub<BR/>
<BR/>
&nbsp; &nbsp; Public Sub&nbsp; Remove( Object )<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; For Each&nbsp; key&nbsp; In Me.Objects.Keys<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Objects( key ) is Object Then<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Me.Objects.Remove&nbsp; key<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Exit Sub<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If<BR/>
&nbsp; &nbsp; &nbsp; &nbsp; Next<BR/>
&nbsp; &nbsp; End Sub<BR/>
End Class</DIV>
<DIV id="text175_3" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:9609px; line-height:15px; white-space:nowrap">
相互参照しているオブジェクトを削除するタイミングを制御するオブジェクト。<BR/>
DestroyerClass のオブジェクトが削除されるときに、相互参照を切るメソッド DestroyReferences <BR/>
を呼び出し、Class_Terminate が呼び出されます。</DIV>
<DIV id="text175_4" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:9830px; line-height:15px; white-space:nowrap">
検証コード</DIV>
<v:line style="position:absolute;" from="123,9671" to="123,9690" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="123,9690" to="127,9679" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="123,9690" to="119,9679" strokecolor="#000000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:88px; margin-top:9699px; width:70px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text175_6" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:96px; margin-top:9705px; line-height:15px; white-space:nowrap">
Destroyer</DIV>
<v:line style="position:absolute;" from="267,9751" to="267,9725" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="267,9725" to="263,9736" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="267,9725" to="271,9736" strokecolor="#FF0000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="267,9751" to="139,9751" strokecolor="#FF0000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:203px; margin-top:9699px; width:23px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text175_9" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:211px; margin-top:9705px; line-height:15px; white-space:nowrap">
A</DIV>
<v:rect style="position:absolute; margin-left:310px; margin-top:9699px; width:25px; height:26px;" fillcolor="#F8FFB0" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text175_10" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:318px; margin-top:9705px; line-height:15px; white-space:nowrap">
B</DIV>
<v:line style="position:absolute;" from="214,9671" to="214,9690" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="214,9690" to="218,9679" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="214,9690" to="210,9679" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="322,9671" to="322,9690" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="322,9690" to="326,9679" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="322,9690" to="318,9679" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="240,9707" to="294,9707" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="294,9707" to="283,9703" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="294,9707" to="283,9711" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="294,9718" to="240,9718" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="240,9718" to="251,9722" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="240,9718" to="251,9714" strokecolor="#000000" strokeweight="1pt"/>
<v:line style="position:absolute;" from="139,9733" to="139,9751" strokecolor="#FF0000" strokeweight="1pt"/>
<v:rect style="position:absolute; margin-left:29px; margin-top:11713px; width:496px; height:310px;" fillcolor="#E7E7E7" strokecolor="#000000" strokeweight="1pt"/>
<DIV id="text175_16" style="position:absolute; font-family: 'ＭＳ ゴシック'; font-size:9pt; color:#000000; margin-left:37px; margin-top:11719px; line-height:15px; white-space:nowrap">
Case1:<BR/>
DestroyerClass::Class_Terminate<BR/>
Case1: A_Class::Class_Terminate<BR/>
Case1: B_Class::Class_Terminate<BR/>
End of Main<BR/>
<BR/>
Case2:<BR/>
DestroyerClass::Class_Terminate<BR/>
End of Main<BR/>
もし、ここ以降でデストラクターが動くときは、プログラム終了時にすべてのオブジェク<BR/>
トを削除することによるデストラクター呼び出しです。<BR/>
Case2: A_Class::Class_Terminate<BR/>
C:\Users\user1\Desktop\MutualRef.vbs(65, 3) Microsoft VBScript 実行時エラー: こ<BR/>
のオブジェクトは相互参照しているため、DestroyerClass の管理下に置く必要がありま<BR/>
す。<BR/>
<BR/>
Case2: B_Class::Class_Terminate<BR/>
C:\Users\user1\Desktop\MutualRef.vbs(65, 3) Microsoft VBScript 実行時エラー: こ<BR/>
のオブジェクトは相互参照しているため、DestroyerClass の管理下に置く必要がありま<BR/>
す。</DIV>
<DIV id="text175_17" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#000000; margin-left:24px; margin-top:11695px; line-height:15px; white-space:nowrap">
表示例：</DIV>
<DIV id="text175_18" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:8pt; color:#FF0000; margin-left:167px; margin-top:9758px; line-height:12px; white-space:nowrap">
相互参照を切る</DIV>
<DIV id="text175_19" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#0000FF; margin-left:72px; margin-top:9787px; line-height:15px; white-space:nowrap">
<A href="..\vbslib.files\vbslib_23.html#DestroyerClass">
→ DestroyerClass (vbslib)</A></DIV>
<DIV id="text175_20" style="position:absolute; font-family: 'ＭＳ Ｐゴシック'; font-size:10pt; color:#408080; font-weight: bold; margin-left:24px; margin-top:9787px; line-height:15px; white-space:nowrap">
関連</DIV>

<v:line from="0,9562" to="731,9562"/>
<v:line from="731,9562" to="731,12055"/>
<v:line from="731,12055" to="0,12055"/>
<v:line from="0,12055" to="0,9562"/>

<DIV style="position:absolute; margin-left:0px; margin-top:12055px;">
<A id="svgcats_vml_p175" class="to_tree" onClick="selectTreeElem( '175' );">←</A></DIV>
<DIV style="position:absolute; margin-left:20px; margin-top:12055px;">
<A id="page_group_bottom" href="vbs_memo_12.html#page_group_top" style="text-decoration:none;">↓</A></DIV>
</PAGE>
 
</PAGESET>

<TABLE height="100%" style="position:absolute; margin-top:-9999px"><TR><TD></TD></TR></TABLE>

</BODY>
</HTML> 
 
